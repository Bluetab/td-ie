# Changelog

## [4.50.0] 2022-09-05

### Changed

- [TD-5091] Dynamic `domain` fields are now integer ids instead of embedded
  documents

## [4.48.0] 2022-07-26

### Fixed

- [TD-5011] `TemplateCache.list/0` was returning duplicate entries

### Changed

- [TD-3614] Support for access token revocation

## [4.46.0] 2022-06-20

### Changed

- [TD-4739] Validate dynamic content for safety to prevent XSS attacks

## [4.45.0] 2022-06-06

### Changed

- Updated dependencies

## [4.40.0] 2022-03-14

### Changed

- [TD-2501] Database timeout and pool size can now be configured using
  `DB_TIMEOUT_MILLIS` and `DB_POOL_SIZE` environment variables
- [TD-4461] Avoid reindexing when a domain is modified
- [TD-4491] Compatibility with new permissions model

## [4.36.0] 2022-01-24

### Added

- [TD-4312]
  - Autogenerated template identifier field
  - Prevent identifier change if a new ingest version is created
  - Mapping to search by identifier

## [4.31.0] 2021-11-02

### Added

- [TD-4124] Dependent domain field in td_df_lib

## [4.28.0] 2021-09-20

### Added

- [TD-3971] Template mandatory dependent field

### Fixed

- [TD-4037] change the limit on the taxonomy in aggregations

## [4.27.0] 2021-09-07

### Changed

- [TD-3973] Update td-df-lib for default values in swith fields

## [4.25.0] 2021-07-26

### Changed

- Updated dependencies

## [4.24.0] 2021-07-13

### Added

- [TD-3230] Taxonomy aggregations with enriched information

## [4.21.0] 2021-05-31

### Changed

- [TD-3753] Build using Elixir 1.12 and Erlang/OTP 24
- [TD-3502] Update td-cache and td-df-lib

## [4.20.0] 2021-05-17

### Changed

- Security patches from `alpine:3.13`
- Update dependencies

## [4.19.0] 2021-05-04

### Added

- [TD-3628] Force release to update base image

## [4.17.0] 2021-04-05

### Changed

- [TD-3445] Postgres port configurable through `DB_PORT` environment variable

## [4.15.0] 2021-03-08

### Changed

- [TD-3341] Build with `elixir:1.11.3-alpine`, runtime `alpine:3.13`

## [4.14.0] 2021-02-22

### Changed

- [TD-3245] Tested compatibility with PostgreSQL 9.6, 10.15, 11.10, 12.5 and
  13.1. CI pipeline changed to use `postgres:12.5-alpine`.

## [4.13.0] 2021-02-08

### Added

- [TD-3263] Use HTTP Basic authentication for Elasticsearch if environment
  variables `ES_USERNAME` and `ES_PASSWORD` are present

## [4.12.0] 2021-01-25

### Changed

- [TD-3163] Auth tokens now include `role` claim instead of `is_admin` flag
- [TD-3182] Allow to use redis with password

## [4.11.0] 2021-01-11

### Changed

- [TD-3170] Build docker image which runs with non-root user

## [4.10.0] 2020-12-14

### Added

- [TD-2486] Domain selector support (type `domain` in template)

## [4.9.0] 2020-11-30

### Added

- [TD-3089] Widget and type `copy` on df

## [4.6.0] 2020-10-19

### Added

- [TD-2485]:
  - Enrich template fields from cache
  - Mappings for system type of templates

## [4.0.0] 2020-07-01

### Changed

- [TD-2585] Include `domain_ids` in payload of audit events
- [TD-2637] Audit events are now published to a Redis stream
- [TD-2687] Remove `email` and `is_admin` from embedded user data in ingest
  responses

### Removed

- Unused route `/api/ingests/comments` and related modules (comments are
  currently supported by td-bg)

## [3.24.0] 2020-06-15

### Changed

- [TD-2261] Update cache to retrieve new attribute `deleted_at` from structures

## [3.23.0] 2020-06-01

### Changed

- [TD-2629] Update td-df-lib to omit template fields of type `image` on indexing
- [TD-2492] Update td-df-lib to include new numeric template types

## [3.22.0] 2020-05-18

### Added

- [TD-2586] Fields `last_execution` and `execution_status` on search

### Changed

- [TD-2490] td-cache: Updated Taxonomy information on domain update

## [3.19.0] 2020-04-06

### Added

- [TD-2364] Reindex ingests on domain update

## [3.16.0] 2020-02-25

### Added

- [TD-2328] Include `external_id` in ingests domain response

### Changed

- [TD-940] Updated to Elixir 1.10

## [3.15.1] 2020-02-19

### Fixed

- [TD-2344] Added missing flatten of df fields on search mapping

## [3.9.0] 2019-10-28

### Changed

- [TD-2180] Take into account sort parmas on ingests' search

### Fixed

- [TD-2179] When changing the status of an ingest we retrieve domain information

## [3.8.0] 2019-10-14

### Changed

- [TD-1721] Reindex automatically when a template changes
  - Breaking change: New environment variable ES_URL replaces existing
    ES_HOST/ES_PORT

### Fixed

- [TD-2178] Use ingest version id instead of ingest id when reindexing

## [3.7.0] 2019-09-31

### Added

- [TD-1625] Support for df `table` type
- [TD-1837] Ingest version embedded links

## [3.6.0] 2019-09-16

### Fixed

- [TD-2078] Preserve order of ingests in search response

## [3.5.1] 2019-09-03

### Fixed

- [TD-2081] Event stream consumer did not respect redis_host and port config
  options

## [3.5.0] 2019-09-02

### Added

- [TD-2053] Create event on ingest publish

### Fixed

- [TD-1993] Restrict dynamic index mappings to "ie" scope

## [3.4.0] 2019-08-19

### Added

- [TD-2045] File records in ingest_executions
- [TD-2036] Ability to check create permission on ingest

## [3.3.0] 2019-08-05

### Added

- [TD-1560] Enriched description field in template content

### Changed

- [TD-1985] Type of template field user with an aggregation size of 50
- [TD-1995] add new file description in ingest_executions
- [TD-2037] Bump cache version due to lack of performance

## [3.2.0] 2019-07-24

### Removed

- [TD-1994] Remove deprecated relations (parent_id, related_to) from model

### Changed

- [TD-2002] Update td-cache and delete permissions list from config

## [3.1.0] 2019-07-08

### Changed

- [TD-1618] Cache improvements (use td-cache instead of td-perms)
- [TD-1924] Use Jason instead of Poison for JSON encoding/decoding

## [3.0.0] 2019-06-25

### Changed

- [TD-1893] Use CI_JOB_ID instead of CI_PIPELINE_ID

## [2.21.0] 2019-06-04

### Changed

- [TD-1789] update ES mappings according to template format

## [2.20.0] 2019-05-27

### Fixed

- [TD-1774] Newline is missing in logger format

### Changed

- Updated dependencies: phoenix 1.4, ecto 3.0, td_df_lib 2.19.3, td_perms 2.19.1

## [2.16.0] 2019-04-02

### Added

- [TD-1571] Elixir's Logger config will check for EX_LOGGER_FORMAT variable to
  override format
- [TD-1573] On IngestExecutions adds file_name and file_size and makes
  end_timestamp not required

## [2.12.2] 2019-01-29

### Fix

- [TD-1371] Fix end-point to add executions by name when there are many versions

## [2.12.1] 2019-01-28

### Fix

- [TD-1371] Fix end-point to add executions by name

## [2.12.0] 2019-01-15

### Added

- [TD-1371] Added end-point to add executions by name

## [2.11.0] 2019-01-15

### Added

- Added support for Ingest Executions

## [0.0.3] 2018-12-07

### Added

- New post endpoint which recieves some params in order to narrow the retrieved
  filters

## [0.0.2] 2018-12-03

### Added

- Adding new permissions to td_perms library

## [0.0.1] 2018-11-30

### Added

- Release version
